


//function sendFileResponse(filePath, version, socket, closeConnection) {
//
//    // checks for unauthorized access: if the file path starts with the given server root folder.
//    if (filePath.indexOf(serverStaticRootFolder) != 0) {
//        sendErrorResponse(401, socket, closeConnection);
//        writeLog("hujiwebserver", "sendFileResponse", "unauthorized access to: " + filePath, true);
//        return;
//    }
//
//
//
//    fs.stat(filePath, function (err, stats) {
//        if (err || !stats.isFile()) {
//            writeLog("hujiwebserver", "sendFileResponse", filePath + " is not a file or doesn't exist", true);
//            sendErrorResponse(404, socket, closeConnection);
//            return;
//        }
//
//        // opens the file as a readable stream
//        var fileAsAStream = fs.createReadStream(filePath);
//
//        // waits until we know the readable stream is actually valid before piping
//        fileAsAStream.on("open", function() {
//
//            // send header part
//            var response = httpObjects.createHttpResponse(version, "200", reasonPharseContent[200],
//                {"Content-Type" : identifyType(filePath), "Content-Length" : stats.size},"");
//
//            socket.write(parser.stringify(response));
//
//            // send 'body' content
//            fileAsAStream.pipe(socket, {end: false});
//
//            if (closeConnection)
//                socket.end();
//        });
//
//        // catches any errors that happen while creating the readable stream (usually invalid names)
//        fileAsAStream.on("error", function(err) {
//            writeLog("hujiwebserver", "sendFileResponse", "An error had occurred: " + err, true);
//            sendErrorResponse(404, socket, closeConnection);
//        })
//    })
//}


// TODO probably all of the function content should be move to hujidynamicserver except the last line
//function onRequestArrival(request, socket) {
//    var httpRequest = parser.parse(request);
//
//    // if the request is missing or in bad format, return (the error response was already sent)
//    if (httpRequest === null || httpRequest === undefined) {
//        return;
//    }
//
//    // since the request isn't missing, update socket.buffer to holds the data received after reading the received data
//    socket.buffer = httpRequest.leftData;
//
//    // TODO: This line must me set to the http response (by using: response.closeConnection(shouldCloseConnection(httpRequest)) ) !!
//    var closeConnection = shouldCloseConnection(httpRequest);
//
//    if (!isValidRequest(httpRequest, socket, closeConnection)) {
//        return;
//    }
//
//    var filePath = preparePath(httpRequest.path);
//    if (filePath === null) {
//        sendErrorResponse(400, socket, closeConnection);
//        return;
//    }
//
//    //sendFileResponse(filePath, httpRequest.version, socket, closeConnection);
//}


//function shouldCloseConnection(httpRequest) {
//    if (httpRequest.version === "http/1.0" && httpRequest.header["connection"] !== "keep-alive") {
//        return true;
//    }
//
//    if (httpRequest.header["connection"] === "close") {
//        return true;
//    }
//
//    return false;
//}

// for static request, we need to append the requested uri to the server root path
//function preparePath(requestPath) {
//    // supports spaces inside the uri
//    requestPath = requestPath.replace(/%20/g,' ');
//
//    // adds '/' to the start (if necessary)
//    if (requestPath.indexOf('/') !== 0)
//        requestPath = "/" + requestPath;
//
//    try {
//        return path.resolve(serverStaticRootFolder + requestPath);
//    } catch (e) {
//        return null;
//    }
//}


//function isValidRequest(httpRequest, socket, closeConnection) {
//
//    if (!httpRequest.version || httpRequest.version === "" || httpRequest.version.indexOf("HTTP/1.") !== 0) {
//        writeLog("hujiwebserver", "isValidRequest", "wrong http version", true);
//        sendErrorResponse(400, socket, closeConnection);
//        return false;
//    }
//
//    // checks if httpRequest.method is valid (i.e, it exists in methodOptions map)
//    var isContained = false;
//
//    for (var i=0; i < methodOptions.length; i++) {
//        if (methodOptions[i] === httpRequest.method) {
//            isContained = true;
//            break;
//        }
//    }
//
//    if (!isContained) {
//        writeLog("hujiwebserver", "isValidRequest", "wrong method request", true);
//        sendErrorResponse(400, socket, closeConnection);
//        return false;
//    }
//
//    return true;
//}




//function sendErrorResponse(errCode, socket, closeConnection) {
//    var errResponse = httpObjects.createHttpResponse("HTTP/1.1", errCode, reasonPharseContent[errCode],
//        {"Content-Type" : "text/plain", "Content-Length" : errBody[errCode].length}, errBody[errCode]);
//
//    socket.write(parser.stringify(errResponse));
//
//    if (closeConnection)
//        socket.end();
//}





/***************** OLD HUJI WEBSERVER START AND STOP *******************/


//
    //try {
    //    serverStaticRootFolder = path.resolve(rootFolder);
    //
    //    // verify that the received root folder is exists
    //    if (!fs.existsSync(serverStaticRootFolder)) {
    //        writeLog("hujiwebserver", "start", "invalid server root folder", true);
    //        callBack("invalid server root folder");
    //        return -1;
    //    }
    //} catch (e) {
    //    callBack("invalid server root folder");
    //    return -1;
    //}

    //var server = hujiNet.createServer(port, onRequestArrival, callBack);
    //
    //servers[serversNextId] = server;
    //
    //return serversNextId++;


//
//exports.stop = function (serverID, callBack) {
//
//    var asInt = parseInt(serverID);
//
//    if (!asInt in servers) return;
//
//    servers[asInt].close();
//    delete servers[asInt];
//
//    // This will allow our server to close any left connections until it can be closed completely.
//    setTimeout(function() {
//        callBack();
//    }, 2000);
//};



/***********************************************/


/**
 OLD VERSION OF IS VALID REQUEST


 function isValidRequest(httpRequest, socket, closeConnection) {

    if (!httpRequest.version || httpRequest.version === "" || httpRequest.version.indexOf("HTTP/1.") !== 0) {
        writeLog("hujiwebserver", "isValidRequest", "wrong http version", true);
        return false;
    }


    var methodOptions = ["options", "get", "head", "post", "put", "delete", "trace", "connect"];

    // checks if httpRequest.method is valid (i.e, it exists in methodOptions map)
    var isContained = false;
    for (var i in methodOptions) {
        if (methodOptions[i] === httpRequest.method) {
            isContained = true;
            break;
        }
    }

    if (!isContained) {
        writeLog("hujiwebserver", "isValidRequest", "wrong method request", true);
        return false;
    }

    return true;
}
 */